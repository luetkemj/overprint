<meta http-equiv="content-type" charset="utf-8">
<canvas id="demo"></canvas>
<script src="../overprint.js"></script>
<script>
  const { Cell, Font, TextGrid } = overprint;
  const canvas = document.getElementById("demo");
  canvas.style.width = document.documentElement.clientWidth.toString() + "px";;
  canvas.style.height = document.documentElement.clientHeight.toString() + "px";;
  canvas.style.margin = '0px';
  canvas.style.padding = '0px';
  document.body.style.margin = '0px';
  document.body.style.padding = '0px';

  const swatch = [
    Cell.blank( "#070707"),
    Cell.blank( "#1E0706"),
    Cell.blank( "#2E1006"),
    Cell.blank( "#470F06"),
    Cell.blank( "#571707"),
    Cell.blank( "#671F07"),
    Cell.blank( "#771E06"),
    Cell.blank( "#8F2607"),
    Cell.blank( "#9F2E06"),
    Cell.blank( "#AF3F06"),
    Cell.blank( "#BF4708"),
    Cell.blank( "#C74707"),
    Cell.blank( "#DF4F06"),
    Cell.blank( "#DF5807"),
    Cell.blank( "#DF5807"),
    Cell.blank( "#D75F07"),
    Cell.blank( "#D7670F"),
    Cell.blank( "#CF6F0F"),
    Cell.blank( "#CF800F"),
    Cell.blank( "#CF8718"),
    Cell.blank( "#C68717"),
    Cell.blank( "#C7971E"),
    Cell.blank( "#BF9F1F"),
    Cell.blank( "#BFA726"),
    Cell.blank( "#BFA726"),
    Cell.blank( "#BFAF2F"),
    Cell.blank( "#B6AF2E"),
    Cell.blank( "#B7B62E"),
    Cell.blank( "#B7B736"),
    Cell.blank( "#CFCF6F"),
    Cell.blank( "#DFDF9F"),
    Cell.blank( "#EFEFC7"),
    Cell.blank( "#FFFFFF")
  ];

  const fireWidth = 170;
  const fireHeight = 122;

  const grid = new TextGrid(canvas, {
    width: fireWidth,
    height: fireHeight,
    font: Font('Menlo', 'normal', 2)
  });

  function doFire() {
    for (let x=0; x<fireWidth; x++) {
      for (let y=1; y<fireHeight; y++) {
        spreadFire(y * fireWidth + x);
      }
    }
  }

  function spreadFire(src) {
    let noise = Math.round(Math.random() * 3.0) & 3;
    let dst = src - noise + 1;
    fireTiles[dst - fireWidth] = fireTiles[src] - (noise & 1);
  }

  function drawFire() {
    for (let i=0; i<fireWidth*fireHeight; i++) {
      grid.writeCell(i % fireWidth, Math.floor(i / fireWidth), swatch[fireTiles[i]]);
    }

    grid.render();
  }

  const fireTiles = [];

  function init() {
    for (let i=0; i<fireWidth*fireHeight; i++) {
      fireTiles[i] = 0;
    }

    for (let=i=0; i<fireWidth; i++) {
      fireTiles[(fireHeight-1) * fireWidth + i] = swatch.length-1;
    }
  }

  function main() {
    doFire();
    drawFire();
    window.requestAnimationFrame(main);
  }

  init();
  drawFire();

  window.requestAnimationFrame(main);
</script>
