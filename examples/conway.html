<meta http-equiv="content-type" charset="utf-8">
<canvas id="demo"></canvas>
<script src="terminal.js"></script>
<script>

var swatches = [
	['#E22A3F', '#B96D63', '#32AF94', '#324249', '#2AA6E2'],
	['#52414C', '#596157', '#5B8C5A', '#CFD186', '#E3655B'],
	['#54457F', '#AC7B84', '#4C243B', '#B84A62', '#F5A6E6'],
	['#F0BA61', '#F48244', '#D55437', '#EF4640', '#C13936'],
	['#CAE7B9', '#F3DE8A', '#EB9486', '#7E7F9A', '#97A7B3'],
	["#00ebb2", "#00c595", "#00a17a", "#138770"],
];

function pickColor() {
	return swatches[Math.floor(Math.random() * swatches.length)];
}

var colors = pickColor();

var canvas = document.getElementById("demo");
var defaultGlyph = Overprint.Glyph(Overprint.Char.NULL, 'black', '#ccc');

var vWidth = document.documentElement.clientWidth;
var vHeight = document.documentElement.clientHeight;

document.body.style.margin = '0px';

canvas.style.margin = '0px';
canvas.style.width = vWidth.toString() + "px";
canvas.style.height = vHeight.toString() + "px";

var columns = 36;
var rows = 20;

var terminal = new Overprint.Terminal(columns, rows, canvas);

terminal.clear(defaultGlyph);

var currentState = [];

for (var x=0; x < columns; x++) {
	currentState[x] = [];
	for (var y=0; y < rows; y++) {
		currentState[x][y] = Math.floor(Math.random() * 2);
		//currentState[x][y] = 0;
	}
}

var nextState = currentState;

function nextGeneration() {
	for (var x=0; x < columns; x++) {
		for (var y=0; y < rows; y++) {

			var neighbours = 0;

			for (var i = -1; i <= 1; i++) {
				var xi = x + i;
				if (xi == -1) xi = columns-1;
				if (xi == columns) xi = 0;
				for (var j = -1; j <= 1; j++) {
					var yj = y + j
					if (yj == -1) yj = rows-1;
					if (yj == rows) yj = 0;
					neighbours += currentState[xi][yj];
				}
			}

			neighbours -= currentState[x][y];

			// Die if the cell is alive and less than 2 neighbours are alive
			if ((currentState[x][y] == 1) && (neighbours < 2)) { 
				nextState[x][y] = 0;
			// Die if the cell is alive and more than 3 neighbours are alive
			} else if ((currentState[x][y] == 1) && (neighbours > 3)) {
				nextState[x][y] = 0;
			// Spawn if the cell is dead and exactly 3 neighbours are alive
			} else if ((currentState[x][y] == 0) && (neighbours == 3)) {
				nextState[x][y] = 1;
			// Otherwise the cell stays in the same state
			} else { 
				nextState[x][y] = currentState[x][y]; 
			}
		}
	}

	currentState = nextState;
}

var alive = function() {
	var color = colors[Math.floor(Math.random() * colors.length)];
	return Overprint.Glyph(Overprint.Char.NULL, 'black', color);
}

var color = colors[Math.floor(Math.random() * colors.length)];
//var alive = Overprint.Glyph(Overprint.Char.NULL, 'black', color);

var dead = Overprint.Glyph(Overprint.Char.NULL, 'black', '#ccc');

function renderTiles() {
	for (var x = 0; x < columns; x++) {
		for (var y = 0; y < rows; y++) {
			var glyph = currentState[x][y] ? alive() : dead;
			terminal.writeGlyph(x, y, glyph);
		}
	}
	
	terminal.render();

	nextGeneration();

	//window.requestAnimationFrame(renderTiles);
}

setInterval(renderTiles, 120);

//window.requestAnimationFrame(renderTiles);

</script>